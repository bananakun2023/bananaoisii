<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å¤ªé¼“ã®é”äºº IRIS OUT å®Œå…¨ç‰ˆ</title>
<style>
body {
  margin: 0;
  background: linear-gradient(to bottom, #fceabb, #f8b500);
  overflow: hidden;
  font-family: 'Arial Rounded MT Bold', sans-serif;
  user-select: none;
}
#gameContainer {
  position: relative;
  width: 100%;
  height: 100vh;
  overflow: hidden;
}
#ytplayer {
  position: absolute;
  top: 10px;
  left: 10px;
  width: 320px;
  height: 180px;
  border: 3px solid #222;
  border-radius: 10px;
}
canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
#ui {
  position: absolute;
  top: 0;
  right: 0;
  width: 250px;
  background: rgba(255,255,255,0.5);
  border-left: 3px solid #000;
  border-radius: 10px 0 0 10px;
  padding: 10px;
}
button {
  margin: 5px;
  padding: 8px 14px;
  font-size: 14px;
  border: none;
  border-radius: 8px;
  background: #ff5f00;
  color: white;
  cursor: pointer;
}
button:hover { background: #ff8533; }
h1 {
  position: absolute;
  top: 40%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 48px;
  color: #fff;
  text-shadow: 2px 2px 4px #000;
}
</style>
</head>
<body>
<div id="gameContainer">
  <!-- YouTubeãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
  <iframe id="ytplayer" src="https://www.youtube.com/embed/LmZD-TU96q4?enablejsapi=1&mute=1"
    frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

  <canvas id="gameCanvas"></canvas>
  <div id="ui">
    <button onclick="startGame()">ğŸµ ã‚²ãƒ¼ãƒ é–‹å§‹</button>
    <button onclick="toggleAuto()">ğŸ¤– ã‚ªãƒ¼ãƒˆ</button>
    <button onclick="toggle2P()">ğŸ‘¥ 2P</button>
    <button onclick="toggleEditor()">ğŸ›  è­œé¢ã‚¨ãƒ‡ã‚£ã‚¿</button>
    <button onclick="unmute()">ğŸ”Š éŸ³ON</button>
    <p id="status">çŠ¶æ…‹: å¾…æ©Ÿä¸­</p>
    <p id="score">ã‚¹ã‚³ã‚¢: 0</p>
    <p id="combo">ã‚³ãƒ³ãƒœ: 0</p>
  </div>
</div>

<script>
let canvas = document.getElementById('gameCanvas');
let ctx = canvas.getContext('2d');
let w = window.innerWidth, h = window.innerHeight;
canvas.width = w; canvas.height = h;

let notes = []; // è­œé¢ãƒ‡ãƒ¼ã‚¿
let startTime = 0;
let gameActive = false;
let score = 0, combo = 0;
let autoPlay = false;
let is2P = false;
let editorMode = false;

// ãƒãƒ¼ãƒ„ï¼ˆä¾‹: ã‚¿ã‚¤ãƒ [s], ã‚¿ã‚¤ãƒ—:'don'|'ka'ï¼‰
let baseChart = [
  {time:1.0,type:'don'},
  {time:1.5,type:'ka'},
  {time:2.0,type:'don'},
  {time:2.5,type:'don'},
  {time:3.0,type:'ka'},
  {time:3.5,type:'don'},
  {time:4.0,type:'ka'},
  {time:4.5,type:'don'}
];
notes = baseChart;

function draw() {
  ctx.clearRect(0,0,w,h);
  // èƒŒæ™¯
  ctx.fillStyle = '#fef4c5';
  ctx.fillRect(0,0,w,h);
  // ãƒãƒ¼ãƒ„
  let current = (Date.now()-startTime)/1000;
  for (let n of notes) {
    let x = w - (n.time - current) * 400; // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€Ÿåº¦
    let y = h/2;
    if (n.type==='don') ctx.fillStyle='red';
    else ctx.fillStyle='blue';
    ctx.beginPath();
    ctx.arc(x, y, 40, 0, Math.PI*2);
    ctx.fill();
  }
  // å¤ªé¼“
  ctx.fillStyle = '#000';
  ctx.beginPath();
  ctx.arc(150, h/2, 60, 0, Math.PI*2);
  ctx.fill();
  ctx.fillStyle = '#f00';
  ctx.beginPath();
  ctx.arc(150, h/2, 40, 0, Math.PI*2);
  ctx.fill();

  requestAnimationFrame(draw);
}
draw();

function hit(type){
  if(!gameActive) return;
  let t = (Date.now()-startTime)/1000;
  let nearest = notes.find(n=>Math.abs(n.time-t)<0.2);
  if(nearest && nearest.type===type){
    score+=100; combo++;
    document.getElementById('status').textContent='Perfect!';
    notes.splice(notes.indexOf(nearest),1);
  }else{
    combo=0;
    document.getElementById('status').textContent='Miss!';
  }
  document.getElementById('score').textContent='ã‚¹ã‚³ã‚¢: '+score;
  document.getElementById('combo').textContent='ã‚³ãƒ³ãƒœ: '+combo;
}

window.addEventListener('keydown',e=>{
  if(e.code==='Space') hit('don');
  if(e.code==='Enter') hit('ka');
  if(is2P){
    if(e.code==='KeyW') hit('don');
    if(e.code==='KeyE') hit('ka');
  }
});

function startGame(){
  gameActive=true;
  score=0; combo=0;
  startTime=Date.now();
  document.getElementById('status').textContent='ã‚¹ã‚¿ãƒ¼ãƒˆï¼';
}

function toggleAuto(){
  autoPlay=!autoPlay;
  document.getElementById('status').textContent='ã‚ªãƒ¼ãƒˆ:'+autoPlay;
}
function toggle2P(){
  is2P=!is2P;
  document.getElementById('status').textContent='2P:'+is2P;
}
function toggleEditor(){
  editorMode=!editorMode;
  if(editorMode){
    document.getElementById('status').textContent='ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¢ãƒ¼ãƒ‰:ã‚¯ãƒªãƒƒã‚¯ã§ãƒãƒ¼ãƒ„è¿½åŠ ';
    canvas.onclick=(e)=>{
      let t=(e.clientX/w)*10;
      let type=(Math.random()>0.5)?'don':'ka';
      notes.push({time:t,type:type});
    };
  }else{
    canvas.onclick=null;
    document.getElementById('status').textContent='é€šå¸¸ãƒ¢ãƒ¼ãƒ‰';
  }
}
function unmute(){
  let iframe=document.getElementById('ytplayer');
  iframe.src="https://www.youtube.com/embed/LmZD-TU96q4?enablejsapi=1&autoplay=1&mute=0";
  document.getElementById('status').textContent='éŸ³å£°ON';
}
</script>
</body>
</html>
